<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8"/>
    <title>TabIPTV</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta
            name="viewport"
            content="width=device-width, initial-scale=1, maximum-scale=1"
    />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge"/>
    <link rel="stylesheet" href="/statics/js/sdk.css"/>
    <link rel="stylesheet" href="/statics/js/helper.css"/>
    <link rel="stylesheet" href="/statics/js/iconfont.css"/>
    <!-- 这是默认主题所需的，如果是其他主题则不需要 -->
    <!-- 从 1.1.0 开始 sdk.css 将不支持 IE 11，如果要支持 IE11 请引用这个 css，并把前面那个删了 -->
    <!-- <link rel="stylesheet" href="sdk-ie11.css" /> -->
    <!-- 不过 amis 开发团队几乎没测试过 IE 11 下的效果，所以可能有细节功能用不了，如果发现请报 issue -->
    <style>
        html,
        body,
        .app-wrapper {
          position: relative;
          width: 100%;
          height: 100%;
          margin: 0;
          padding: 0;
        }
    </style>
</head>
<body>
<div id="root" class="app-wrapper"></div>
<script src="/statics/js/sdk.js"></script>
<script type="text/javascript">
    (function () {
    let token = localStorage.getItem("Authorization"); if (!token) location.href = "/login";
      let amis = amisRequire('amis/embed');
      // 通过替换下面这个配置来生成不同页面
      let amisJSON = {
        "type": "page",
        "body": [
        {
    "label": "新增",
    "type": "button",
    "actionType": "dialog",
    "level": "primary",
    "className": "m-b-sm",
    "dialog": {
      "title": "新增頻道",
      "body": {
        "type": "form",
        "api": "post:/tabs",
        "body": [
          {
            "type": "input-text",
            "name": "group_title",
            "label": "group_title"
          },
          {
            "type": "input-text",
            "name": "tvg_id",
            "label": "tvg_id"
          },
          {
            "type": "input-text",
            "name": "tvg_logo",
            "label": "tvg_logo"
          },
          {
            "type": "input-text",
            "name": "tvg_name",
            "label": "tvg_name"
          },
          {
            "type": "input-text",
            "name": "tvg_url",
            "label": "tvg_url"
          },
        ]
      }
    }
  },
        {
          "type": "crud",
          "api": "/tabs",
          "syncLocation": false,
          "columns": [
            {
              "name": "id",
              "label": "ID"
            },
            {
              "name": "group_title",
              "label": "group_title"
            },
            {
              "name": "tvg_id",
              "label": "tvg_id"
            },
            {
              "name": "tvg_logo",
              "label": "tvg_logo"
            },
            {
              "name": "tvg_name",
              "label": "tvg_name"
            },
            {
              "name": "tvg_url",
              "label": "tvg_url"
            },
            {
              "type": "operation",
              "label": "操作",
              "buttons": [
                {
          "label": "编辑",
          "type": "button",
          "actionType": "drawer",
          "drawer": {
            "title": "编辑频道",
            "body": {
              "type": "form",
              "initApi": "/tabs/${id}",
              "api": "post:/tabs/${id}",
              "body": [
                {
                  "type": "input-text",
                  "name": "group_title",
                  "label": "group_title"
                },
                {
                  "type": "input-text",
                  "name": "tvg_id",
                  "label": "tvg_id"
                },
                {
                  "type": "input-text",
                  "name": "tvg_logo",
                  "label": "tvg_logo"
                },
                {
                  "type": "input-text",
                  "name": "tvg_name",
                  "label": "tvg_name"
                },
                {
                  "type": "input-text",
                  "name": "tvg_url",
                  "label": "tvg_url"
                }
              ]
            }
          }
        },
                {
                  "label": "删除",
                  "type": "button",
                  "actionType": "ajax",
                  "level": "danger",
                  "confirmText": "确认要删除？",
                  "api": "delete:/tabs/${id}"
                }
              ]
            }
          ]
        },{
      "type": "divider"
    },{
    "label": "添加路径",
    "type": "button",
    "tooltip": "只建议添加一个路径，然后每次修改，因为没有添加删除按钮",
    "actionType": "dialog",
    "level": "primary",
    "className": "m-b-sm",
    "dialog": {
      "title": "新增路径",
      "body": {
        "type": "form",
        "api": "post:/tab_path",
        "body": [
          {
            "type": "input-text",
            "name": "iptv_path",
            "label": "访问路径"
          }
        ]
      }
    }
  },
        {
          "type": "crud",
          "api": "/tab_path",
          "syncLocation": false,
          "columns": [
          {
              "name": "id",
              "label": "ID"
            },
            {
              "name": "iptv_path",
              "label": "访问路径"
            },
            {
              "type": "operation",
              "label": "操作",
              "buttons": [
                {
          "label": "编辑",
          "type": "button",
          "actionType": "drawer",
          "drawer": {
            "title": "编辑路径",
            "body": {
              "type": "form",
              "initApi": "/tab_path/${id}",
              "api": "post:/tab_path/${id}",
              "body": [
                {
                  "type": "input-text",
                  "name": "iptv_path",
                  "label": "访问路径"
                }
              ]
            }
          }
        }
              ]
            }
          ]
        }]
      };

      var options = {
  fetcher: function (params) {
      var method = params.method;
      var url = params.url;
      var data = params.data;
      return new Promise(function (resolve, reject) {
          fetch(url, {
              method: method,
              headers: new Headers({
                  "Content-Type": "application/json;",
                  "Authorization": localStorage.getItem("Authorization")
              }),
              body: JSON.stringify(data)
          }).then(function (res) {

              if (!res.ok) {
                  if (res.status == 401 || res.status == 403) {
                      ddAlert('提示', '无权访问')
                  }
              }

              return res.json();
          }).then(function (response) {
              resolve({
                  "data": response,
              });
          });
      });
  }
}
      let amisScoped = amis.embed('#root', amisJSON,{},options);
    })();
</script>
</body>
</html>